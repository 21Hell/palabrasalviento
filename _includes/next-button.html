{% comment %} Compute separate next/previous items for poemas and peliculas, and a previous item for the current page's collection. {% endcomment %}
{% assign next_item = nil %}
{% assign next_poema = nil %}
{% assign prev_poema = nil %}
{% assign next_pelicula = nil %}
{% assign prev_pelicula = nil %}
{% assign prev_item = nil %}

{%- comment -%}
  Don't show on the homepage (root). Handle cases where site.baseurl is set.
{%- endcomment -%}
{%- assign home_urls = '/' | split: ',' -%}
{%- assign base = site.baseurl | default: '' -%}
{%- if base != '' -%}
  {%- assign home_urls = home_urls | push: base -%}
  {%- assign home_urls = home_urls | push: base | append: '/' -%}
{%- endif -%}
{%- for h in home_urls -%}
  {%- if page.url == h -%}
    {%- assign next_item = nil -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- comment -%} Next & prev for poemas (always show poema buttons if collection exists) {%- endcomment -%}
{%- comment -%}
  Poemas navigation will be computed later (inside the poemas branch) using Roman numeral order.
{%- endcomment -%}

{%- comment -%} keep searching for a generic next_item if not defined, using posts as fallback {%- endcomment -%}
{% if next_item == nil and site.posts and site.posts.size > 0 %}
  {% assign found = false %}
  {% for item in site.posts %}
    {% if found and next_item == nil %}
      {% assign next_item = item %}
    {% endif %}
    {% if item.url == page.url %}
      {% assign found = true %}
    {% endif %}
  {% endfor %}
  {% if next_item == nil %}
    {% assign next_item = site.posts | first %}
  {% endif %}
{% endif %}

{%- comment -%} Next & prev for peliculas {%- endcomment -%}
{% if site.peliculas and site.peliculas.size > 0 %}
  {% assign found = false %}
  {% for item in site.peliculas %}
    {% if found and next_pelicula == nil %}
      {% assign next_pelicula = item %}
    {% endif %}
    {% if item.url == page.url %}
      {% assign found = true %}
    {% endif %}
  {% endfor %}
  {% if next_pelicula == nil %}
    {% assign next_pelicula = site.peliculas | first %}
  {% endif %}

  {% assign last_seen = nil %}
  {% for item in site.peliculas %}
    {% if item.url == page.url %}
      {% if last_seen %}
        {% assign prev_pelicula = last_seen %}
      {% else %}
        {% assign prev_pelicula = site.peliculas | last %}
      {% endif %}
      {% break %}
    {% endif %}
    {% assign last_seen = item %}
  {% endfor %}
  {% if prev_pelicula == nil %}
    {% assign prev_pelicula = site.peliculas | last %}
  {% endif %}
{% endif %}

{%- comment -%} Render buttons: Previous (for current collection), Next Poema, Next Pelicula {%- endcomment -%}
{%- comment -%} Compute prev_item for the current page by checking each collection in order: poemas, posts, peliculas {%- endcomment -%}
{% if site.poemas and site.poemas.size > 0 %}
  {% assign last_seen = nil %}
  {% for item in site.poemas %}
    {% if item.url == page.url %}
      {% if last_seen %}
        {% assign prev_item = last_seen %}
      {% else %}
        {% assign prev_item = site.poemas | last %}
      {% endif %}
      {% break %}
    {% endif %}
    {% assign last_seen = item %}
  {% endfor %}
{% endif %}
{% if prev_item == nil and site.posts and site.posts.size > 0 %}
  {% assign last_seen = nil %}
  {% for item in site.posts %}
    {% if item.url == page.url %}
      {% if last_seen %}
        {% assign prev_item = last_seen %}
      {% else %}
        {% assign prev_item = site.posts | last %}
      {% endif %}
      {% break %}
    {% endif %}
    {% assign last_seen = item %}
  {% endfor %}
{% endif %}
{% if prev_item == nil and site.peliculas and site.peliculas.size > 0 %}
  {% assign last_seen = nil %}
  {% for item in site.peliculas %}
    {% if item.url == page.url %}
      {% if last_seen %}
        {% assign prev_item = last_seen %}
      {% else %}
        {% assign prev_item = site.peliculas | last %}
      {% endif %}
      {% break %}
    {% endif %}
    {% assign last_seen = item %}
  {% endfor %}
{% endif %}

{%- comment -%} Render navigation only when viewing an individual poema or pelicula page. Place the nav inside the card (not fixed). {%- endcomment -%}

{%- if page.collection == 'poemas' -%}
  {%- comment -%}
    Compute next/prev poem using Roman numerals order based on the title.
    We iterate over a predefined Roman list and, for each numeral, find the poem with that title.
    This avoids relying on dates or file ordering.
  {%- endcomment -%}
  {% assign roman_order_str = "I,II,III,IV,V,VI,VII,VIII,IX,X,XI,XII,XIII,XIV,XV,XVI,XVII,XVIII,XIX,XX,XXI,XXII,XXIII,XXIV,XXV,XXVI,XXVII,XXVIII,XXIX,XXX,XXXI,XXXII,XXXIII,XXXIV,XXXV,XXXVI,XXXVII,XXXVIII,XXXIX,XL,XLI,XLII,XLIII,XLIV,XLV,XLVI,XLVII,XLVIII,XLIX,L,LI,LII,LIII,LIV,LV,LVI,LVII,LVIII,LIX,LX,LXI,LXII,LXIII,LXIV,LXV,LXVI,LXVII,LXVIII,LXIX,LXX,LXXI,LXXII,LXXIII,LXXIV,LXXV,LXXVI,LXXVII,LXXVIII,LXXIX,LXXX,LXXXI,LXXXII,LXXXIII,LXXXIV,LXXXV,LXXXVI,LXXXVII,LXXXVIII,LXXXIX,XC,XCI,XCII,XCIII,XCIV,XCV,XCVI,XCVII,XCVIII,XCIX,C" %}
  {% assign roman_order = roman_order_str | split: ',' %}

  {% assign first_poema = nil %}
  {% assign last_poema_in_list = nil %}
  {% assign prev_poema = nil %}
  {% assign next_poema = nil %}
  {% assign prev_found = nil %}
  {% assign found_current = false %}

  {% for rn in roman_order %}
    {% assign candidate = nil %}
    {% for p in site.poemas %}
      {% if p.title == rn %}
        {% assign candidate = p %}
      {% endif %}
    {% endfor %}
    {% if candidate %}
      {% if first_poema == nil %}
        {% assign first_poema = candidate %}
      {% endif %}
      {% assign last_poema_in_list = candidate %}

      {% if found_current and next_poema == nil %}
        {% assign next_poema = candidate %}
      {% endif %}

      {% if candidate.url == page.url %}
        {% assign found_current = true %}
        {% assign prev_poema = prev_found %}
      {% endif %}

      {% assign prev_found = candidate %}
    {% endif %}
  {% endfor %}

  {%- comment -%} Wrap-around if at the ends {%- endcomment -%}
  {% if found_current and next_poema == nil %}
    {% assign next_poema = first_poema %}
  {% endif %}
  {% if found_current and prev_poema == nil %}
    {% assign prev_poema = last_poema_in_list %}
  {% endif %}

  <style>
    .in-card-nav{ display:flex; gap:0.6rem; justify-content:flex-end; margin-top:1.5rem; }
    .in-card-nav .next-button{ display:inline-block; background:#111; color:#fff; padding:0.45rem 0.7rem; border-radius:8px; text-decoration:none; font-weight:600; box-shadow:0 6px 18px rgba(0,0,0,0.12); font-family:inherit; }
    .in-card-nav .next-button small{ display:block; font-size:0.7rem; color:#ddd; }
    .in-card-nav .next-button--prev{ background:#fff; color:#111; border:1px solid #ddd; }
  </style>

  <div class="in-card-nav">
    {% if prev_poema %}
      <a class="next-button next-button--prev" href="{{ prev_poema.url | relative_url }}" aria-label="Anterior poema: {{ prev_poema.title }}">Anterior Poema: <strong>{{ prev_poema.title }}</strong>
        <small>{% if prev_poema.date %}{% endif %}</small>
      </a>
    {% endif %}
    {% if next_poema %}
      <a class="next-button" href="{{ next_poema.url | relative_url }}" aria-label="Siguiente poema: {{ next_poema.title }}">Siguiente poema: <strong>{{ next_poema.title }}</strong></a>
    {% endif %}
  </div>

  <script>
  document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
      var prev = document.querySelector('.next-button--prev');
      if (prev) window.location.href = prev.href;
    }
    if (e.key === 'ArrowRight') {
      var next = document.querySelector('.next-button:not(.next-button--prev)');
      if (next) window.location.href = next.href;
    }
  });
  </script>

{%- elsif page.collection == 'peliculas' -%}
  {%- comment -%} compute next and prev for peliculas specifically {%- endcomment -%}
  {% if next_pelicula == nil %}
    {% assign found = false %}
    {% for item in site.peliculas %}
      {% if found and next_pelicula == nil %}
        {% assign next_pelicula = item %}
      {% endif %}
      {% if item.url == page.url %}
        {% assign found = true %}
      {% endif %}
    {% endfor %}
    {% if next_pelicula == nil %}
      {% assign next_pelicula = site.peliculas | first %}
    {% endif %}
  {% endif %}

  {% if prev_pelicula == nil %}
    {% assign last_seen = nil %}
    {% for item in site.peliculas %}
      {% if item.url == page.url %}
        {% if last_seen %}
          {% assign prev_pelicula = last_seen %}
        {% else %}
          {% assign prev_pelicula = site.peliculas | last %}
        {% endif %}
        {% break %}
      {% endif %}
      {% assign last_seen = item %}
    {% endfor %}
    {% if prev_pelicula == nil %}
      {% assign prev_pelicula = site.peliculas | last %}
    {% endif %}
  {% endif %}

  <style>
    .in-card-nav{ display:flex; gap:0.6rem; justify-content:flex-end; margin-top:1.5rem; }
    .in-card-nav .next-button{ display:inline-block; background:#111; color:#fff; padding:0.45rem 0.7rem; border-radius:8px; text-decoration:none; font-weight:600; box-shadow:0 6px 18px rgba(0,0,0,0.12); font-family:inherit; }
    .in-card-nav .next-button small{ display:block; font-size:0.7rem; color:#ddd; }
    .in-card-nav .next-button--prev{ background:#fff; color:#111; border:1px solid #ddd; }
  </style>

  <div class="in-card-nav">
    {% if prev_pelicula %}
      <a class="next-button next-button--prev" href="{{ prev_pelicula.url | relative_url }}" aria-label="Anterior película: {{ prev_pelicula.title }}">← Anterior: <strong>{{ prev_pelicula.title }}</strong>
        <small>{% if prev_pelicula.date %}{{ prev_pelicula.date | date: "%Y" }}{% endif %}</small>
      </a>
    {% endif %}
    {% if next_pelicula %}
      <a class="next-button" href="{{ next_pelicula.url | relative_url }}" aria-label="Siguiente película: {{ next_pelicula.title }}">Siguiente película: <strong>{{ next_pelicula.title }}</strong></a>
    {% endif %}
  </div>

{%- else -%}
  {%- comment -%} Not a single-item poema or pelicula page; render nothing. {%- endcomment -%}
{%- endif -%}
